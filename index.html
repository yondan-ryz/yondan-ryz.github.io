<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dog Classification with TensorFlow.js</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
</head>
<body>
    <h1>Dog Classification</h1>
    <input type="file" id="image-upload" />
    <img id="uploaded-image" width="150" />
    <p id="prediction"></p>

    <script>
        // Function to load the TensorFlow.js model
        async function loadModel() {
            // Load the model from the model.json file in the 'public' directory
            const model = await tf.loadLayersModel('/models/model.json');
            console.log('Model loaded successfully!');
            return model;
        }

        // Function to process the uploaded image and make predictions
        async function predictImage() {
            const fileInput = document.getElementById('image-upload');
            const imageElement = document.getElementById('uploaded-image');
            const predictionElement = document.getElementById('prediction');

            if (fileInput.files.length > 0) {
                // Display the uploaded image
                const imageFile = fileInput.files[0];
                imageElement.src = URL.createObjectURL(imageFile);

                // Prepare image for prediction
                const img = new Image();
                img.src = URL.createObjectURL(imageFile);
                img.onload = async function () {
                    // Convert image to tensor, resize, and normalize to 256x256
                    const tensor = tf.browser.fromPixels(img)
                        .resizeNearestNeighbor([150, 150]) // Resize image to match model input of 256x256
                        .toFloat()  // Convert to float32
                        .expandDims(0);  // Add batch dimension: (1, 256, 256, 3)

                    // Load the model and make the prediction
                    const model = await loadModel();
                    const prediction = model.predict(tensor);

                    // Get the class index with the highest probability
                    const predictedClassIndex = prediction.argMax(-1).dataSync()[0];

                    // Define the class mapping (adjust according to your model's classes)
                    const classMapping = {"0": "animal dog afghan", "1": "animal dog african_wild_dog", "2": "animal dog airedale", "3": "animal dog american_bulldog", "4": "animal dog american_hairless", "5": "animal dog american_spaniel", "6": "animal dog basenji", "7": "animal dog basset", "8": "animal dog basset_hound", "9": "animal dog beagle", "10": "animal dog bearded_collie", "11": "animal dog bermaise"};

                    // Display the predicted class label
                    predictionElement.innerText = `Predicted Class: ${classMapping[predictedClassIndex]}`;
                };
            }
        }

        // Event listener to trigger image processing when a file is uploaded
        document.getElementById('image-upload').addEventListener('change', predictImage);
    </script>
</body>
</html>
