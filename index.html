<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TensorFlow.js Model</title>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest"></script>
</head>
<body>
  <h1>Prediksi Model Keras dengan TensorFlow.js</h1>
  <input type="file" id="imageUpload" accept="image/*" />
  <br />
  <button onclick="predict()">Prediksi</button>
  <p id="result"></p>

  <script src="app.js"></script>
</body>
<script>

let model;

// Memuat model dan bobot
async function loadModel() {
  model = await tf.loadLayersModel('models/model.json');  // Ganti dengan path model.json Anda
  console.log("Model Loaded Successfully");
}

// Menyiapkan input dan memproses gambar
async function processImage(file) {
  const img = new Image();
  img.src = URL.createObjectURL(file);
  
  return new Promise((resolve, reject) => {
    img.onload = () => {
      // Membuat tensor dengan ukuran yang sesuai dengan input model [200, 200, 3]
      const tensor = tf.browser.fromPixels(img)
        .resizeNearestNeighbor([200, 200]) // Resize gambar ke 200x200
        .toFloat()
        .div(tf.scalar(255))  // Normalisasi ke rentang [0, 1]
        .expandDims();  // Menambahkan dimensi batch [1, 200, 200, 3]
      
      resolve(tensor);
    };
    img.onerror = (err) => reject(err);
  });
}

// Prediksi gambar
async function predict() {
  const fileInput = document.getElementById('imageUpload');
  const file = fileInput.files[0];
  
  if (file && model) {
    try {
      const tensor = await processImage(file);
      const prediction = model.predict(tensor);
      const output = prediction.dataSync();  // Mengambil hasil prediksi

      // Menampilkan hasil prediksi
      document.getElementById('result').innerText = `Prediksi: ${output}`;
    } catch (error) {
      console.error("Terjadi kesalahan saat memproses gambar:", error);
    }
  } else {
    alert("Model atau gambar belum dimuat.");
  }
}

// Muat model saat halaman dibuka
loadModel();
</script>
</html>
