<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Prediksi Gambar dengan TensorFlow.js</title>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
</head>
<body>

  <h1>Prediksi Gambar dengan Model TensorFlow.js</h1>

  <input type="file" id="image-upload" accept="image/*" />
  <br/>
  <canvas id="canvas"></canvas>
  <br/>
  <button id="predict-button">Prediksi</button>
  <br/>
  <p id="prediction-result">Hasil prediksi: </p>

  <script>
    let model;

    // Fungsi untuk memuat model
    async function loadModel() {
      try {
        // Memuat model dari server (sesuaikan dengan lokasi model Anda)
        model = await tf.loadLayersModel('/models/model.json');
        console.log("Model berhasil dimuat");
      } catch (error) {
        console.error("Terjadi kesalahan saat memuat model: ", error);
      }
    }

    // Fungsi untuk memproses gambar yang diunggah
    function processImage(file) {
      const image = new Image();
      image.onload = function () {
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = image.width;
        canvas.height = image.height;
        ctx.drawImage(image, 0, 0);

        // Mengonversi gambar ke tensor dan menyesuaikan bentuknya
        let imgTensor = tf.browser.fromPixels(canvas);
        imgTensor = imgTensor.resizeBilinear([200, 200]); // Sesuaikan ukuran gambar sesuai dengan model
        imgTensor = imgTensor.expandDims(0); // Menambahkan dimensi batch

        return imgTensor;
      };
      image.src = URL.createObjectURL(file);
    }

    // Fungsi untuk melakukan prediksi
    async function makePrediction() {
      const imageFile = document.getElementById('image-upload').files[0];
      if (!imageFile) {
        alert("Silakan unggah gambar terlebih dahulu.");
        return;
      }

      const imgTensor = processImage(imageFile);

      const prediction = await model.predict(imgTensor);
      const predictedClass = prediction.argMax(-1).dataSync()[0]; // Ambil kelas dengan probabilitas tertinggi
      document.getElementById('prediction-result').textContent = 'Hasil prediksi: Kelas ' + predictedClass;
    }

    // Event Listener untuk tombol prediksi
    document.getElementById('predict-button').addEventListener('click', makePrediction);

    // Memuat model saat halaman dimuat
    loadModel();
  </script>

</body>
</html>
