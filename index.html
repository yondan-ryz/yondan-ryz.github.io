<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dog Classification with TensorFlow.js</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
</head>
<body>
    <h1>Dog Classification</h1>
    <input type="file" id="image-upload" />
    <img id="uploaded-image" width="150" />
    <p id="prediction"></p>

    <script>
        // Fungsi untuk memuat model TensorFlow.js
        async function loadModel() {
            // Ganti dengan path model.json yang sesuai (pastikan model.json dan group1-shard1of1.bin berada di folder yang sama atau dapat diakses)
            const model = await tf.loadLayersModel('model/model.json');
            console.log('Model loaded successfully!');
            return model;
        }

        // Fungsi untuk memproses gambar dan membuat prediksi
        async function predictImage() {
            const fileInput = document.getElementById('image-upload');
            const imageElement = document.getElementById('uploaded-image');
            const predictionElement = document.getElementById('prediction');

            if (fileInput.files.length > 0) {
                // Tampilkan gambar yang diunggah
                const imageFile = fileInput.files[0];
                imageElement.src = URL.createObjectURL(imageFile);

                // Persiapkan gambar untuk prediksi
                const img = new Image();
                img.src = URL.createObjectURL(imageFile);
                img.onload = async function () {
                    // Mengubah gambar menjadi tensor dan melakukan resize
                    const tensor = tf.browser.fromPixels(img)
                        .resizeNearestNeighbor([150, 150]) // Ukuran yang sesuai dengan model
                        .toFloat()
                        .expandDims();

                    // Memuat model dan melakukan prediksi
                    const model = await loadModel();
                    const prediction = model.predict(tensor);

                    // Ambil kelas dengan probabilitas tertinggi
                    const predictedClassIndex = prediction.argMax(-1).dataSync()[0];

                    // Ganti dengan pemetaan kelas yang sesuai
                    const classMapping = {
                        0: "Cat",
                        1: "Dog",
                        2: "Bird" // Ganti dengan kelas yang sesuai
                    };

                    // Tampilkan hasil prediksi
                    predictionElement.innerText = `Prediksi kelas: ${classMapping[predictedClassIndex]}`;
                };
            }
        }

        // Event listener untuk memproses gambar saat diupload
        document.getElementById('image-upload').addEventListener('change', predictImage);
    </script>
</body>
</html>
